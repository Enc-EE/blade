!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o=function(){function e(){var e=this;this.animations=[],this.updates=[],this.addAnimation=function(t){e.animations.push(t)},this.removeAnimation=function(t){e.animations.splice(e.animations.indexOf(t),1)},this.addUpdate=function(t){e.updates.push(t)},this.removeUpdate=function(t){e.updates.splice(e.updates.indexOf(t),1)},this.addAnimatable=function(t){e.updates.push(t.update),e.animations.push(t.draw)},this.removeAnimatable=function(t){e.updates.splice(e.updates.indexOf(t.update),1),e.animations.splice(e.animations.indexOf(t.draw),1)},this.fps=40,this.fpsInterval=1e3/this.fps,this.animate=function(){requestAnimationFrame(e.animate);var t=Date.now(),n=t-e.lastFrameTime;if(n>e.fpsInterval){e.lastFrameTime=t;for(var o=0,i=e.updates;o<i.length;o++){(0,i[o])(n)}e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height);for(var r=0,a=e.animations;r<a.length;r++){(0,a[r])(e.ctx,e.canvas.width,e.canvas.height)}}}}return Object.defineProperty(e.prototype,"width",{get:function(){return this.canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.canvas.height},enumerable:!0,configurable:!0}),e.createInBody=function(){document.body.parentElement.style.height="100%",document.body.style.height="100%",document.body.style.margin="0",document.body.style.overflow="hidden";var t=document.createElement("canvas");document.body.appendChild(t),t.style.width="100%",t.style.height="100%";var n=new e;return n.canvas=t,n.ctx=t.getContext("2d"),n.startAnimation(),n.resize(),n},e.prototype.resize=function(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight},e.prototype.startAnimation=function(){this.lastFrameTime=Date.now(),this.animate()},e}(),i=function(){return function(e,t,n,o,i){var r=this;this.name=e,this.xAxes=0,this.yAxes=0,document.addEventListener("keydown",function(e){e.keyCode==t&&(r.xAxes=-1),e.keyCode==n&&(r.yAxes=-1),e.keyCode==o&&(r.xAxes=1),e.keyCode==i&&(r.yAxes=1)}),document.addEventListener("keyup",function(e){e.keyCode==t&&(r.xAxes=-1)&&(r.xAxes=0),e.keyCode==n&&(r.yAxes=-1)&&(r.yAxes=0),e.keyCode==o&&(r.xAxes=1)&&(r.xAxes=0),e.keyCode==i&&(r.yAxes=1)&&(r.yAxes=0)})}}(),r=function(){function e(e,t){this.name=e,this.index=t}return Object.defineProperty(e.prototype,"xAxes",{get:function(){return navigator.getGamepads()[this.index].axes[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yAxes",{get:function(){return navigator.getGamepads()[this.index].axes[1]},enumerable:!0,configurable:!0}),e}(),a=function(){function e(e,t,n){var o=this;this.controller=e,this.onAdd=t,this.onRemove=n,this.isShown=!1,this.isAdded=!1,this.addTimerSeconds=2,this.rememberedX=0,this.rememberedY=0,this.update=function(e){o.isShown?o.isAdded?(o.angle=o.angle+Math.PI/9,o.angle=o.angle%(2*Math.PI),o.x=o.rememberedX+25*o.controller.xAxes,o.y=o.rememberedY+25*o.controller.yAxes,o.controller.yAxes>.3?(o.addTimer+=o.controller.yAxes*e/1e3,o.addTimer>=o.addTimerSeconds&&(o.addTimer=0,o.isShown=!1,o.isAdded=!1,o.onRemove(o))):o.controller.yAxes<.1&&(o.addTimer=0)):o.controller.yAxes<-.3?(o.addTimer-=o.controller.yAxes*e/1e3,o.addTimer>=o.addTimerSeconds&&(o.isAdded=!0,o.addTimer=0)):o.controller.yAxes>-.1&&(o.addTimer=0,o.isShown=!1,o.onRemove(o)):o.controller.yAxes<-.3&&(o.isShown=!0,o.addTimer-=o.controller.yAxes*e/1e3,o.onAdd(o),o.rememberedX=o.x,o.rememberedY=o.y)},this.draw=function(e,t,n){e.fillStyle=o.color,e.save(),e.translate(o.x,o.y),o.isAdded&&(e.save(),e.rotate(o.angle),e.fillRect(-25,-25,50,50),e.restore()),o.isShown&&!o.isAdded&&e.fillRect(-25,35,50/o.addTimerSeconds*o.addTimer,10),o.isShown&&o.isAdded&&o.addTimer>0&&e.fillRect(-25,35,50-50/o.addTimerSeconds*o.addTimer,10),e.restore()},this.color="black",this.x=0,this.y=0,this.angle=0,this.addTimer=0}return Object.defineProperty(e.prototype,"controllerName",{get:function(){return this.controller.name},enumerable:!0,configurable:!0}),e}(),d="ongamepadconnected"in window,s=function(){function e(){var e=this;this.isPlayerSelection=!0,this.controllerNames=[],this.controllers=[],this.addController=function(t){if(console.log("added controller "+t.controllerName),e.controllerNames.length<=4){e.controllerNames.push(t.controllerName);var n="black",o=0,i=0;switch(e.controllerNames.length){case 1:n="red",o=e.animation.width/3,i=(e.animation.height-100)/3+100;break;case 2:n="green",o=e.animation.width/3*2,i=(e.animation.height-100)/3+100;break;case 3:n="blue",o=e.animation.width/3,i=(e.animation.height-100)/3*2+100;break;case 4:n="orange",o=e.animation.width/3*2,i=(e.animation.height-100)/3*2+100}t.color=n,t.x=o,t.y=i}else console.log("Sorry, only 4 controllers supported")},this.removeController=function(t){console.log("removed controller "+t.controllerName),e.controllerNames.splice(e.controllerNames.indexOf(t.controllerName),1)},this.connecthandler=function(t){e.addgamepad(t.gamepad)},this.scangamepads=function(){for(var t=navigator.getGamepads?navigator.getGamepads():[],n=0;n<t.length;n++)t[n]&&(t[n].index in e.controllers?e.controllers[t[n].index]=t[n]:e.addgamepad(t[n]))},this.disconnecthandler=function(t){e.removegamepad(t.gamepad)},this.removegamepad=function(t){delete e.controllers[t.index]},this.addgamepad=function(t){var n=new a(new r(t.index.toString(),t.index),e.addController,e.removeController);e.animation.addAnimatable(n),e.controllers[t.index]=t}}return e.prototype.run=function(){if(this.animation=o.createInBody(),this.isPlayerSelection){this.animation.addAnimation(function(e,t,n){e.fillStyle="black",e.textAlign="center",e.font="22px sans-serif",e.fillText("You can control a blade with a gamepad, the arrow keys or WASD.",t/2,50),e.fillText("Press up to join and down to leave.",t/2,80),e.fillText("Press enter on keyboard or start on a controller to start.",t/2,110)});var e=new a(new i("arrows",37,38,39,40),this.addController,this.removeController);this.animation.addAnimatable(e);var t=new a(new i("wasd",65,87,68,83),this.addController,this.removeController);this.animation.addAnimatable(t)}window.addEventListener("gamepadconnected",this.connecthandler),window.addEventListener("gamepaddisconnected",this.disconnecthandler),d||setInterval(this.scangamepads,500)},e}();document.addEventListener("DOMContentLoaded",function(){(new s).run()},!1)}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FuaW1hdGlvbi50cyIsIndlYnBhY2s6Ly8vLi9zcmMva2V5Ym9hcmRDb250cm9scy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZXBhZENvbnRyb2xzLnRzIiwid2VicGFjazovLy8uL3NyYy9tZW51QmxhZGUudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FwcC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJBbmltYXRpb24iLCJfdGhpcyIsInRoaXMiLCJhbmltYXRpb25zIiwidXBkYXRlcyIsImFkZEFuaW1hdGlvbiIsImZ1bmMiLCJwdXNoIiwicmVtb3ZlQW5pbWF0aW9uIiwic3BsaWNlIiwiaW5kZXhPZiIsImFkZFVwZGF0ZSIsInJlbW92ZVVwZGF0ZSIsImFkZEFuaW1hdGFibGUiLCJhbmltYXRhYmxlIiwidXBkYXRlIiwiZHJhdyIsInJlbW92ZUFuaW1hdGFibGUiLCJmcHMiLCJmcHNJbnRlcnZhbCIsImFuaW1hdGUiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJub3ciLCJEYXRlIiwiZWxhcHNlZCIsImxhc3RGcmFtZVRpbWUiLCJfaSIsIl9hIiwibGVuZ3RoIiwiY3R4IiwiY2xlYXJSZWN0IiwiY2FudmFzIiwid2lkdGgiLCJoZWlnaHQiLCJfYiIsIl9jIiwiY3JlYXRlSW5Cb2R5IiwiZG9jdW1lbnQiLCJib2R5IiwicGFyZW50RWxlbWVudCIsInN0eWxlIiwibWFyZ2luIiwib3ZlcmZsb3ciLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJhbmltYXRpb24iLCJnZXRDb250ZXh0Iiwic3RhcnRBbmltYXRpb24iLCJyZXNpemUiLCJjbGllbnRXaWR0aCIsImNsaWVudEhlaWdodCIsIktleWJvYXJkQ29udHJvbHMiLCJsZWZ0S2V5IiwidXBLZXkiLCJyaWdodEtleSIsImRvd25LZXkiLCJ4QXhlcyIsInlBeGVzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwia2V5Q29kZSIsIkdhbWVwYWRDb250cm9scyIsImluZGV4IiwibmF2aWdhdG9yIiwiZ2V0R2FtZXBhZHMiLCJheGVzIiwiTWVudUJsYWRlIiwiY29udHJvbGxlciIsIm9uQWRkIiwib25SZW1vdmUiLCJpc1Nob3duIiwiaXNBZGRlZCIsImFkZFRpbWVyU2Vjb25kcyIsInJlbWVtYmVyZWRYIiwicmVtZW1iZXJlZFkiLCJ0aW1lRGlmZk1zIiwiYW5nbGUiLCJNYXRoIiwiUEkiLCJ4IiwieSIsImFkZFRpbWVyIiwiZmlsbFN0eWxlIiwiY29sb3IiLCJzYXZlIiwidHJhbnNsYXRlIiwicm90YXRlIiwiZmlsbFJlY3QiLCJyZXN0b3JlIiwiaGF2ZUV2ZW50cyIsIndpbmRvdyIsImFwcF9BcHAiLCJBcHAiLCJpc1BsYXllclNlbGVjdGlvbiIsImNvbnRyb2xsZXJOYW1lcyIsImNvbnRyb2xsZXJzIiwiYWRkQ29udHJvbGxlciIsIm1lbnVCbGFkZSIsImNvbnNvbGUiLCJsb2ciLCJjb250cm9sbGVyTmFtZSIsInN0YXJ0WCIsInN0YXJ0WSIsInJlbW92ZUNvbnRyb2xsZXIiLCJjb25uZWN0aGFuZGxlciIsImUiLCJhZGRnYW1lcGFkIiwiZ2FtZXBhZCIsInNjYW5nYW1lcGFkcyIsImdhbWVwYWRzIiwiZGlzY29ubmVjdGhhbmRsZXIiLCJyZW1vdmVnYW1lcGFkIiwiYmxhZGUiLCJ0b1N0cmluZyIsInJ1biIsInRleHRBbGlnbiIsImZvbnQiLCJmaWxsVGV4dCIsImJsYWRlMSIsImJsYWRlMiIsInNldEludGVydmFsIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLElBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsWUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsR0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNaLEVBQUFrQixFQUFBLFNBQUFoQixHQUNBLG9CQUFBaUIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQWIsRUFBQWlCLE9BQUFDLGFBQXdEQyxNQUFBLFdBRXhEUCxPQUFBQyxlQUFBYixFQUFBLGNBQWlEbUIsT0FBQSxLQVFqRHJCLEVBQUFzQixFQUFBLFNBQUFELEVBQUFFLEdBRUEsR0FEQSxFQUFBQSxJQUFBRixFQUFBckIsRUFBQXFCLElBQ0EsRUFBQUUsRUFBQSxPQUFBRixFQUNBLEtBQUFFLEdBQUEsaUJBQUFGLFFBQUFHLFdBQUEsT0FBQUgsRUFDQSxJQUFBSSxFQUFBWCxPQUFBWSxPQUFBLE1BR0EsR0FGQTFCLEVBQUFrQixFQUFBTyxHQUNBWCxPQUFBQyxlQUFBVSxFQUFBLFdBQXlDVCxZQUFBLEVBQUFLLFVBQ3pDLEVBQUFFLEdBQUEsaUJBQUFGLEVBQUEsUUFBQU0sS0FBQU4sRUFBQXJCLEVBQUFVLEVBQUFlLEVBQUFFLEVBQUEsU0FBQUEsR0FBZ0gsT0FBQU4sRUFBQU0sSUFBcUJDLEtBQUEsS0FBQUQsSUFDckksT0FBQUYsR0FJQXpCLEVBQUE2QixFQUFBLFNBQUExQixHQUNBLElBQUFTLEVBQUFULEtBQUFxQixXQUNBLFdBQTJCLE9BQUFyQixFQUFBLFNBQzNCLFdBQWlDLE9BQUFBLEdBRWpDLE9BREFILEVBQUFVLEVBQUFFLEVBQUEsSUFBQUEsR0FDQUEsR0FJQVosRUFBQWEsRUFBQSxTQUFBaUIsRUFBQUMsR0FBc0QsT0FBQWpCLE9BQUFrQixVQUFBQyxlQUFBMUIsS0FBQXVCLEVBQUFDLElBR3REL0IsRUFBQWtDLEVBQUEsR0FJQWxDLElBQUFtQyxFQUFBLHlDQzFFQSxJQUFBQyxFQUFBLFdBZ0JJLFNBQUFBLElBQUEsSUFBQUMsRUFBQUMsS0FiUUEsS0FBQUMsY0FDQUQsS0FBQUUsV0E0Q0RGLEtBQUFHLGFBQWUsU0FBQ0MsR0FDbkJMLEVBQUtFLFdBQVdJLEtBQUtELElBR2xCSixLQUFBTSxnQkFBa0IsU0FBQ0YsR0FDdEJMLEVBQUtFLFdBQVdNLE9BQU9SLEVBQUtFLFdBQVdPLFFBQVFKLEdBQU8sSUFHbkRKLEtBQUFTLFVBQVksU0FBQ0wsR0FDaEJMLEVBQUtHLFFBQVFHLEtBQUtELElBR2ZKLEtBQUFVLGFBQWUsU0FBQ04sR0FDbkJMLEVBQUtHLFFBQVFLLE9BQU9SLEVBQUtHLFFBQVFNLFFBQVFKLEdBQU8sSUFHN0NKLEtBQUFXLGNBQWdCLFNBQUNDLEdBQ3BCYixFQUFLRyxRQUFRRyxLQUFLTyxFQUFXQyxRQUM3QmQsRUFBS0UsV0FBV0ksS0FBS08sRUFBV0UsT0FHN0JkLEtBQUFlLGlCQUFtQixTQUFDSCxHQUN2QmIsRUFBS0csUUFBUUssT0FBT1IsRUFBS0csUUFBUU0sUUFBUUksRUFBV0MsUUFBUyxHQUM3RGQsRUFBS0UsV0FBV00sT0FBT1IsRUFBS0UsV0FBV08sUUFBUUksRUFBV0UsTUFBTyxJQUk3RGQsS0FBQWdCLElBQU0sR0FDTmhCLEtBQUFpQixZQUFjLElBQU9qQixLQUFLZ0IsSUFFMUJoQixLQUFBa0IsUUFBVSxXQUNkQyxzQkFBc0JwQixFQUFLbUIsU0FFM0IsSUFBSUUsRUFBTUMsS0FBS0QsTUFDWEUsRUFBVUYsRUFBTXJCLEVBQUt3QixjQUV6QixHQUFJRCxFQUFVdkIsRUFBS2tCLFlBQWEsQ0FDNUJsQixFQUFLd0IsY0FBZ0JILEVBRXJCLElBQXFCLElBQUFJLEVBQUEsRUFBQUMsRUFBQTFCLEVBQUtHLFFBQUxzQixFQUFBQyxFQUFBQyxPQUFBRixJQUFjLEVBQy9CWCxFQURhWSxFQUFBRCxJQUNORixHQUdYdkIsRUFBSzRCLElBQUlDLFVBQVUsRUFBRyxFQUFHN0IsRUFBSzhCLE9BQU9DLE1BQU8vQixFQUFLOEIsT0FBT0UsUUFFeEQsSUFBc0IsSUFBQUMsRUFBQSxFQUFBQyxFQUFBbEMsRUFBS0UsV0FBTCtCLEVBQUFDLEVBQUFQLE9BQUFNLElBQWlCLEVBQ25DZCxFQURjZSxFQUFBRCxJQUNOakMsRUFBSzRCLElBQUs1QixFQUFLOEIsT0FBT0MsTUFBTy9CLEVBQUs4QixPQUFPRSxXQUlqRSxPQTNGSXZELE9BQUFDLGVBQVdxQixFQUFBSixVQUFBLGFBQVgsV0FDSSxPQUFPTSxLQUFLNkIsT0FBT0MsdUNBR3ZCdEQsT0FBQUMsZUFBV3FCLEVBQUFKLFVBQUEsY0FBWCxXQUNJLE9BQU9NLEtBQUs2QixPQUFPRSx3Q0FNVGpDLEVBQUFvQyxhQUFkLFdBQ0lDLFNBQVNDLEtBQUtDLGNBQWNDLE1BQU1QLE9BQVMsT0FDM0NJLFNBQVNDLEtBQUtFLE1BQU1QLE9BQVMsT0FDN0JJLFNBQVNDLEtBQUtFLE1BQU1DLE9BQVMsSUFDN0JKLFNBQVNDLEtBQUtFLE1BQU1FLFNBQVcsU0FFL0IsSUFBSVgsRUFBU00sU0FBU00sY0FBYyxVQUNwQ04sU0FBU0MsS0FBS00sWUFBWWIsR0FDMUJBLEVBQU9TLE1BQU1SLE1BQVEsT0FDckJELEVBQU9TLE1BQU1QLE9BQVMsT0FFdEIsSUFBSVksRUFBWSxJQUFJN0MsRUFNcEIsT0FMQTZDLEVBQVVkLE9BQVNBLEVBQ25CYyxFQUFVaEIsSUFBTUUsRUFBT2UsV0FBVyxNQUVsQ0QsRUFBVUUsaUJBQ1ZGLEVBQVVHLFNBQ0hILEdBR0o3QyxFQUFBSixVQUFBb0QsT0FBUCxXQUNJOUMsS0FBSzZCLE9BQU9DLE1BQVE5QixLQUFLNkIsT0FBT2tCLFlBQ2hDL0MsS0FBSzZCLE9BQU9FLE9BQVMvQixLQUFLNkIsT0FBT21CLGNBRzlCbEQsRUFBQUosVUFBQW1ELGVBQVAsV0FDSTdDLEtBQUt1QixjQUFnQkYsS0FBS0QsTUFDMUJwQixLQUFLa0IsV0FxRGJwQixFQWxHQSxHQ05BbUQsRUFBQSxXQThDQSxPQTFDSSxTQUFtQjVFLEVBQWM2RSxFQUFpQkMsRUFBZUMsRUFBa0JDLEdBQW5GLElBQUF0RCxFQUFBQyxLQUFtQkEsS0FBQTNCLE9BQ2YyQixLQUFLc0QsTUFBUSxFQUNidEQsS0FBS3VELE1BQVEsRUFFYnBCLFNBQVNxQixpQkFBaUIsVUFBVyxTQUFDQyxHQUM5QkEsRUFBTUMsU0FBV1IsSUFDakJuRCxFQUFLdUQsT0FBUyxHQUVkRyxFQUFNQyxTQUFXUCxJQUNqQnBELEVBQUt3RCxPQUFTLEdBRWRFLEVBQU1DLFNBQVdOLElBQ2pCckQsRUFBS3VELE1BQVEsR0FFYkcsRUFBTUMsU0FBV0wsSUFDakJ0RCxFQUFLd0QsTUFBUSxLQUlyQnBCLFNBQVNxQixpQkFBaUIsUUFBUyxTQUFDQyxHQUM1QkEsRUFBTUMsU0FBV1IsSUFDYm5ELEVBQUt1RCxPQUFTLEtBQ2R2RCxFQUFLdUQsTUFBUSxHQUdqQkcsRUFBTUMsU0FBV1AsSUFDYnBELEVBQUt3RCxPQUFTLEtBQ2R4RCxFQUFLd0QsTUFBUSxHQUdqQkUsRUFBTUMsU0FBV04sSUFDYnJELEVBQUt1RCxNQUFRLEtBQ2J2RCxFQUFLdUQsTUFBUSxHQUdqQkcsRUFBTUMsU0FBV0wsSUFDYnRELEVBQUt3RCxNQUFRLEtBQ2J4RCxFQUFLd0QsTUFBUSxNQXpDakMsR0NBQUksRUFBQSxXQWFJLFNBQUFBLEVBQW1CdEYsRUFBc0J1RixHQUF0QjVELEtBQUEzQixPQUFzQjJCLEtBQUE0RCxRQUU3QyxPQWRJcEYsT0FBQUMsZUFBV2tGLEVBQUFqRSxVQUFBLGFBQVgsV0FHSSxPQUZlbUUsVUFBVUMsY0FDUDlELEtBQUs0RCxPQUNiRyxLQUFLLG9DQUduQnZGLE9BQUFDLGVBQVdrRixFQUFBakUsVUFBQSxhQUFYLFdBR0ksT0FGZW1FLFVBQVVDLGNBQ1A5RCxLQUFLNEQsT0FDYkcsS0FBSyxvQ0FLdkJKLEVBZkEsR0NDQUssRUFBQSxXQWlCSSxTQUFBQSxFQUFvQkMsRUFBZ0NDLEVBQTJDQyxHQUEvRixJQUFBcEUsRUFBQUMsS0FBb0JBLEtBQUFpRSxhQUFnQ2pFLEtBQUFrRSxRQUEyQ2xFLEtBQUFtRSxXQWZ2Rm5FLEtBQUFvRSxTQUFVLEVBQ1ZwRSxLQUFBcUUsU0FBVSxFQUVWckUsS0FBQXNFLGdCQUFrQixFQUdsQnRFLEtBQUF1RSxZQUFjLEVBQ2R2RSxLQUFBd0UsWUFBYyxFQWdCZnhFLEtBQUFhLE9BQVMsU0FBQzRELEdBQ1QxRSxFQUFLcUUsUUFDRHJFLEVBQUtzRSxTQUNMdEUsRUFBSzJFLE1BQVEzRSxFQUFLMkUsTUFBUUMsS0FBS0MsR0FBSyxFQUNwQzdFLEVBQUsyRSxNQUFRM0UsRUFBSzJFLE9BQW1CLEVBQVZDLEtBQUtDLElBQ2hDN0UsRUFBSzhFLEVBQUk5RSxFQUFLd0UsWUFBc0MsR0FBeEJ4RSxFQUFLa0UsV0FBV1gsTUFDNUN2RCxFQUFLK0UsRUFBSS9FLEVBQUt5RSxZQUFzQyxHQUF4QnpFLEVBQUtrRSxXQUFXVixNQUV4Q3hELEVBQUtrRSxXQUFXVixNQUFRLElBQ3hCeEQsRUFBS2dGLFVBQVloRixFQUFLa0UsV0FBV1YsTUFBUWtCLEVBQWEsSUFDbEQxRSxFQUFLZ0YsVUFBWWhGLEVBQUt1RSxrQkFDdEJ2RSxFQUFLZ0YsU0FBVyxFQUNoQmhGLEVBQUtxRSxTQUFVLEVBQ2ZyRSxFQUFLc0UsU0FBVSxFQUNmdEUsRUFBS29FLFNBQVNwRSxLQUVYQSxFQUFLa0UsV0FBV1YsTUFBUSxLQUMvQnhELEVBQUtnRixTQUFXLElBR2hCaEYsRUFBS2tFLFdBQVdWLE9BQVMsSUFDekJ4RCxFQUFLZ0YsVUFBWWhGLEVBQUtrRSxXQUFXVixNQUFRa0IsRUFBYSxJQUVsRDFFLEVBQUtnRixVQUFZaEYsRUFBS3VFLGtCQUN0QnZFLEVBQUtzRSxTQUFVLEVBQ2Z0RSxFQUFLZ0YsU0FBVyxJQUViaEYsRUFBS2tFLFdBQVdWLE9BQVMsS0FDaEN4RCxFQUFLZ0YsU0FBVyxFQUNoQmhGLEVBQUtxRSxTQUFVLEVBQ2ZyRSxFQUFLb0UsU0FBU3BFLElBSWxCQSxFQUFLa0UsV0FBV1YsT0FBUyxLQUN6QnhELEVBQUtxRSxTQUFVLEVBQ2ZyRSxFQUFLZ0YsVUFBWWhGLEVBQUtrRSxXQUFXVixNQUFRa0IsRUFBYSxJQUN0RDFFLEVBQUttRSxNQUFNbkUsR0FDWEEsRUFBS3dFLFlBQWN4RSxFQUFLOEUsRUFDeEI5RSxFQUFLeUUsWUFBY3pFLEVBQUsrRSxJQUk3QjlFLEtBQUFjLEtBQU8sU0FBQ2EsRUFBK0JHLEVBQWdCQyxHQUMxREosRUFBSXFELFVBQVlqRixFQUFLa0YsTUFDckJ0RCxFQUFJdUQsT0FDSnZELEVBQUl3RCxVQUFVcEYsRUFBSzhFLEVBQUc5RSxFQUFLK0UsR0FDdkIvRSxFQUFLc0UsVUFDTDFDLEVBQUl1RCxPQUNKdkQsRUFBSXlELE9BQU9yRixFQUFLMkUsT0FDaEIvQyxFQUFJMEQsVUFBVSxJQUFLLEdBQUksR0FBSSxJQUMzQjFELEVBQUkyRCxXQUdKdkYsRUFBS3FFLFVBQVlyRSxFQUFLc0UsU0FDdEIxQyxFQUFJMEQsVUFBVSxHQUFJLEdBQUksR0FBS3RGLEVBQUt1RSxnQkFBa0J2RSxFQUFLZ0YsU0FBVSxJQUdqRWhGLEVBQUtxRSxTQUFXckUsRUFBS3NFLFNBQVd0RSxFQUFLZ0YsU0FBVyxHQUNoRHBELEVBQUkwRCxVQUFVLEdBQUksR0FBSSxHQUFLLEdBQUt0RixFQUFLdUUsZ0JBQWtCdkUsRUFBS2dGLFNBQVUsSUFHMUVwRCxFQUFJMkQsV0FyRUp0RixLQUFLaUYsTUFBUSxRQUNiakYsS0FBSzZFLEVBQUksRUFDVDdFLEtBQUs4RSxFQUFJLEVBQ1Q5RSxLQUFLMEUsTUFBUSxFQUNiMUUsS0FBSytFLFNBQVcsRUFtRXhCLE9BNUVJdkcsT0FBQUMsZUFBV3VGLEVBQUF0RSxVQUFBLHNCQUFYLFdBQ0ksT0FBT00sS0FBS2lFLFdBQVc1RixzQ0EyRS9CMkYsRUF6RkEsR0NHSXVCLEVBQWEsdUJBQXdCQyxPQUV6Q0MsRUFBQSxvQkFBQUMsSUFBQSxJQUFBM0YsRUFBQUMsS0FDWUEsS0FBQTJGLG1CQUE2QixFQUM3QjNGLEtBQUE0RixtQkFFUjVGLEtBQUE2RixlQXVDUTdGLEtBQUE4RixjQUFnQixTQUFDQyxHQUdyQixHQUZBQyxRQUFRQyxJQUFJLG9CQUFzQkYsRUFBVUcsZ0JBRXhDbkcsRUFBSzZGLGdCQUFnQmxFLFFBQVUsRUFBRyxDQUNsQzNCLEVBQUs2RixnQkFBZ0J2RixLQUFLMEYsRUFBVUcsZ0JBQ3BDLElBQUlqQixFQUFRLFFBQ1JrQixFQUFTLEVBQ1RDLEVBQVMsRUFDYixPQUFRckcsRUFBSzZGLGdCQUFnQmxFLFFBQ3pCLEtBQUssRUFDRHVELEVBQVEsTUFDUmtCLEVBQVNwRyxFQUFLNEMsVUFBVWIsTUFBUSxFQUNoQ3NFLEdBQVVyRyxFQUFLNEMsVUFBVVosT0FBUyxLQUFPLEVBQUksSUFDN0MsTUFDSixLQUFLLEVBQ0RrRCxFQUFRLFFBQ1JrQixFQUFTcEcsRUFBSzRDLFVBQVViLE1BQVEsRUFBSSxFQUNwQ3NFLEdBQVVyRyxFQUFLNEMsVUFBVVosT0FBUyxLQUFPLEVBQUksSUFDN0MsTUFDSixLQUFLLEVBQ0RrRCxFQUFRLE9BQ1JrQixFQUFTcEcsRUFBSzRDLFVBQVViLE1BQVEsRUFDaENzRSxHQUFVckcsRUFBSzRDLFVBQVVaLE9BQVMsS0FBTyxFQUFJLEVBQUksSUFDakQsTUFDSixLQUFLLEVBQ0RrRCxFQUFRLFNBQ1JrQixFQUFTcEcsRUFBSzRDLFVBQVViLE1BQVEsRUFBSSxFQUNwQ3NFLEdBQVVyRyxFQUFLNEMsVUFBVVosT0FBUyxLQUFPLEVBQUksRUFBSSxJQUd6RGdFLEVBQVVkLE1BQVFBLEVBQ2xCYyxFQUFVbEIsRUFBSXNCLEVBQ2RKLEVBQVVqQixFQUFJc0IsT0FFZEosUUFBUUMsSUFBSSx3Q0FJWmpHLEtBQUFxRyxpQkFBbUIsU0FBQ04sR0FDeEJDLFFBQVFDLElBQUksc0JBQXdCRixFQUFVRyxnQkFFOUNuRyxFQUFLNkYsZ0JBQWdCckYsT0FBT1IsRUFBSzZGLGdCQUFnQnBGLFFBQVF1RixFQUFVRyxnQkFBaUIsSUFHeEZsRyxLQUFBc0csZUFBaUIsU0FBQ0MsR0FDZHhHLEVBQUt5RyxXQUFXRCxFQUFFRSxVQUd0QnpHLEtBQUEwRyxhQUFlLFdBRVgsSUFEQSxJQUFJQyxFQUFXOUMsVUFBVUMsWUFBY0QsVUFBVUMsaUJBQ3hDaEcsRUFBSSxFQUFHQSxFQUFJNkksRUFBU2pGLE9BQVE1RCxJQUM3QjZJLEVBQVM3SSxLQUNMNkksRUFBUzdJLEdBQUc4RixTQUFTN0QsRUFBSzhGLFlBQzFCOUYsRUFBSzhGLFlBQVljLEVBQVM3SSxHQUFHOEYsT0FBUytDLEVBQVM3SSxHQUUvQ2lDLEVBQUt5RyxXQUFXRyxFQUFTN0ksTUFNekNrQyxLQUFBNEcsa0JBQW9CLFNBQUNMLEdBQ2pCeEcsRUFBSzhHLGNBQWNOLEVBQUVFLFVBR3pCekcsS0FBQTZHLGNBQWdCLFNBQUNKLFVBQ04xRyxFQUFLOEYsWUFBWVksRUFBUTdDLFFBR3BDNUQsS0FBQXdHLFdBQWEsU0FBQ0MsR0FDVixJQUFJSyxFQUFRLElBQUk5QyxFQUFVLElBQUlMLEVBQWdCOEMsRUFBUTdDLE1BQU1tRCxXQUFZTixFQUFRN0MsT0FBUTdELEVBQUsrRixjQUFlL0YsRUFBS3NHLGtCQUNqSHRHLEVBQUs0QyxVQUFVaEMsY0FBY21HLEdBQzdCL0csRUFBSzhGLFlBQVlZLEVBQVE3QyxPQUFTNkMsR0FFMUMsT0EvR1dmLEVBQUFoRyxVQUFBc0gsSUFBUCxXQVlJLEdBWEFoSCxLQUFLMkMsVUFBWTdDLEVBQVVvQyxlQVd2QmxDLEtBQUsyRixrQkFBbUIsQ0FDeEIzRixLQUFLMkMsVUFBVXhDLGFBQWEsU0FBQ3dCLEVBQUtHLEVBQU9DLEdBQ3JDSixFQUFJcUQsVUFBWSxRQUNoQnJELEVBQUlzRixVQUFZLFNBQ2hCdEYsRUFBSXVGLEtBQU8sa0JBQ1h2RixFQUFJd0YsU0FBUyxrRUFBbUVyRixFQUFRLEVBQUcsSUFDM0ZILEVBQUl3RixTQUFTLHNDQUF1Q3JGLEVBQVEsRUFBRyxJQUMvREgsRUFBSXdGLFNBQVMsNkRBQThEckYsRUFBUSxFQUFHLE9BRzFGLElBQUlzRixFQUFTLElBQUlwRCxFQUFVLElBQUlmLEVBQWlCLFNBQVUsR0FBSSxHQUFJLEdBQUksSUFBS2pELEtBQUs4RixjQUFlOUYsS0FBS3FHLGtCQUNwR3JHLEtBQUsyQyxVQUFVaEMsY0FBY3lHLEdBQzdCLElBQUlDLEVBQVMsSUFBSXJELEVBQVUsSUFBSWYsRUFBaUIsT0FBUSxHQUFJLEdBQUksR0FBSSxJQUFLakQsS0FBSzhGLGNBQWU5RixLQUFLcUcsa0JBQ2xHckcsS0FBSzJDLFVBQVVoQyxjQUFjMEcsR0FHakM3QixPQUFPaEMsaUJBQWlCLG1CQUFvQnhELEtBQUtzRyxnQkFDakRkLE9BQU9oQyxpQkFBaUIsc0JBQXVCeEQsS0FBSzRHLG1CQUUvQ3JCLEdBQ0QrQixZQUFZdEgsS0FBSzBHLGFBQWMsTUErRTNDaEIsRUFySEEsR0NOQXZELFNBQVNxQixpQkFBaUIsbUJBRTFCLFlBQ2MsSUFBSWlDLEdBQ1p1QixRQUo4QyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwidHlwZSBBbmltYXRpb25GdW5jdGlvbiA9IChjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgd2lkdGg/OiBudW1iZXIsIGhlaWdodD86IG51bWJlcikgPT4gdm9pZDtcclxudHlwZSBVcGRhdGVGdW5jdGlvbiA9ICh0aW1lRGlmZk1zOiBudW1iZXIpID0+IHZvaWQ7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEFuaW1hdGFibGUge1xyXG4gICAgdXBkYXRlOiBVcGRhdGVGdW5jdGlvbjtcclxuICAgIGRyYXc6IEFuaW1hdGlvbkZ1bmN0aW9uO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQW5pbWF0aW9uIHtcclxuICAgIHByaXZhdGUgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudDtcclxuICAgIHByaXZhdGUgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcbiAgICBwcml2YXRlIGFuaW1hdGlvbnM6IEFuaW1hdGlvbkZ1bmN0aW9uW10gPSBbXTtcclxuICAgIHByaXZhdGUgdXBkYXRlczogVXBkYXRlRnVuY3Rpb25bXSA9IFtdO1xyXG5cclxuXHJcbiAgICBwdWJsaWMgZ2V0IHdpZHRoKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLndpZHRoO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgaGVpZ2h0KCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLmhlaWdodDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHsgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgY3JlYXRlSW5Cb2R5KCk6IEFuaW1hdGlvbiB7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5wYXJlbnRFbGVtZW50LnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5tYXJnaW4gPSBcIjBcIjtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcclxuXHJcbiAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTtcclxuICAgICAgICBjYW52YXMuc3R5bGUud2lkdGggPSBcIjEwMCVcIlxyXG4gICAgICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcclxuXHJcbiAgICAgICAgdmFyIGFuaW1hdGlvbiA9IG5ldyBBbmltYXRpb24oKTtcclxuICAgICAgICBhbmltYXRpb24uY2FudmFzID0gY2FudmFzO1xyXG4gICAgICAgIGFuaW1hdGlvbi5jdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuXHJcbiAgICAgICAgYW5pbWF0aW9uLnN0YXJ0QW5pbWF0aW9uKCk7XHJcbiAgICAgICAgYW5pbWF0aW9uLnJlc2l6ZSgpO1xyXG4gICAgICAgIHJldHVybiBhbmltYXRpb247XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlc2l6ZSgpIHtcclxuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMuY2FudmFzLmNsaWVudFdpZHRoO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMuY2FudmFzLmNsaWVudEhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhcnRBbmltYXRpb24oKSB7XHJcbiAgICAgICAgdGhpcy5sYXN0RnJhbWVUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgICAgICB0aGlzLmFuaW1hdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkQW5pbWF0aW9uID0gKGZ1bmM6IEFuaW1hdGlvbkZ1bmN0aW9uKSA9PiB7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb25zLnB1c2goZnVuYyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlbW92ZUFuaW1hdGlvbiA9IChmdW5jOiBBbmltYXRpb25GdW5jdGlvbikgPT4ge1xyXG4gICAgICAgIHRoaXMuYW5pbWF0aW9ucy5zcGxpY2UodGhpcy5hbmltYXRpb25zLmluZGV4T2YoZnVuYyksIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRVcGRhdGUgPSAoZnVuYzogVXBkYXRlRnVuY3Rpb24pID0+IHtcclxuICAgICAgICB0aGlzLnVwZGF0ZXMucHVzaChmdW5jKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVtb3ZlVXBkYXRlID0gKGZ1bmM6IFVwZGF0ZUZ1bmN0aW9uKSA9PiB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVzLnNwbGljZSh0aGlzLnVwZGF0ZXMuaW5kZXhPZihmdW5jKSwgMSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFkZEFuaW1hdGFibGUgPSAoYW5pbWF0YWJsZTogQW5pbWF0YWJsZSkgPT4ge1xyXG4gICAgICAgIHRoaXMudXBkYXRlcy5wdXNoKGFuaW1hdGFibGUudXBkYXRlKTtcclxuICAgICAgICB0aGlzLmFuaW1hdGlvbnMucHVzaChhbmltYXRhYmxlLmRyYXcpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyByZW1vdmVBbmltYXRhYmxlID0gKGFuaW1hdGFibGU6IEFuaW1hdGFibGUpID0+IHtcclxuICAgICAgICB0aGlzLnVwZGF0ZXMuc3BsaWNlKHRoaXMudXBkYXRlcy5pbmRleE9mKGFuaW1hdGFibGUudXBkYXRlKSwgMSk7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb25zLnNwbGljZSh0aGlzLmFuaW1hdGlvbnMuaW5kZXhPZihhbmltYXRhYmxlLmRyYXcpLCAxKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxhc3RGcmFtZVRpbWU6IG51bWJlcjtcclxuICAgIHByaXZhdGUgZnBzID0gNDA7XHJcbiAgICBwcml2YXRlIGZwc0ludGVydmFsID0gMTAwMCAvIHRoaXMuZnBzO1xyXG5cclxuICAgIHByaXZhdGUgYW5pbWF0ZSA9ICgpID0+IHtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5hbmltYXRlKTtcclxuXHJcbiAgICAgICAgdmFyIG5vdyA9IERhdGUubm93KCk7XHJcbiAgICAgICAgdmFyIGVsYXBzZWQgPSBub3cgLSB0aGlzLmxhc3RGcmFtZVRpbWU7XHJcblxyXG4gICAgICAgIGlmIChlbGFwc2VkID4gdGhpcy5mcHNJbnRlcnZhbCkge1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RGcmFtZVRpbWUgPSBub3c7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHVwZGF0ZSBvZiB0aGlzLnVwZGF0ZXMpIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZShlbGFwc2VkKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG5cclxuICAgICAgICAgICAgZm9yIChjb25zdCBhbmltYXRlIG9mIHRoaXMuYW5pbWF0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0ZSh0aGlzLmN0eCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBDb250cm9sbGVyIH0gZnJvbSBcIi4vY29udHJvbGxlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEtleWJvYXJkQ29udHJvbHMgaW1wbGVtZW50cyBDb250cm9sbGVyIHtcclxuICAgIHB1YmxpYyB4QXhlczogbnVtYmVyO1xyXG4gICAgcHVibGljIHlBeGVzOiBudW1iZXI7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIG5hbWU6IHN0cmluZywgbGVmdEtleTogbnVtYmVyLCB1cEtleTogbnVtYmVyLCByaWdodEtleTogbnVtYmVyLCBkb3duS2V5OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnhBeGVzID0gMDtcclxuICAgICAgICB0aGlzLnlBeGVzID0gMDtcclxuXHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSBsZWZ0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnhBeGVzID0gLTFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSB1cEtleSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy55QXhlcyA9IC0xO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09IHJpZ2h0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnhBeGVzID0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSBkb3duS2V5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnlBeGVzID0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSBsZWZ0S2V5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy54QXhlcyA9IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54QXhlcyA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gdXBLZXkpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnlBeGVzID0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnlBeGVzID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSByaWdodEtleSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMueEF4ZXMgPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy54QXhlcyA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gZG93bktleSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMueUF4ZXMgPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55QXhlcyA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IENvbnRyb2xsZXIgfSBmcm9tIFwiLi9jb250cm9sbGVyXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgR2FtZXBhZENvbnRyb2xzIGltcGxlbWVudHMgQ29udHJvbGxlciB7XHJcbiAgICBwdWJsaWMgZ2V0IHhBeGVzKCk6IG51bWJlciB7XHJcbiAgICAgICAgdmFyIGdhbWVwYWRzID0gbmF2aWdhdG9yLmdldEdhbWVwYWRzKCk7XHJcbiAgICAgICAgdmFyIGdwID0gZ2FtZXBhZHNbdGhpcy5pbmRleF07XHJcbiAgICAgICAgcmV0dXJuIGdwLmF4ZXNbMF07XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCB5QXhlcygpOiBudW1iZXIge1xyXG4gICAgICAgIHZhciBnYW1lcGFkcyA9IG5hdmlnYXRvci5nZXRHYW1lcGFkcygpO1xyXG4gICAgICAgIHZhciBncCA9IGdhbWVwYWRzW3RoaXMuaW5kZXhdO1xyXG4gICAgICAgIHJldHVybiBncC5heGVzWzFdO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBuYW1lOiBzdHJpbmcsIHByaXZhdGUgaW5kZXg6IG51bWJlcikge1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgQW5pbWF0YWJsZSB9IGZyb20gXCIuL2FuaW1hdGlvblwiO1xyXG5pbXBvcnQgeyBDb250cm9sbGVyIH0gZnJvbSBcIi4vY29udHJvbGxlclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1lbnVCbGFkZSBpbXBsZW1lbnRzIEFuaW1hdGFibGUge1xyXG4gICAgcHJpdmF0ZSBhbmdsZTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBpc1Nob3duID0gZmFsc2U7XHJcbiAgICBwcml2YXRlIGlzQWRkZWQgPSBmYWxzZTtcclxuICAgIHByaXZhdGUgYWRkVGltZXI6IG51bWJlcjtcclxuICAgIHByaXZhdGUgYWRkVGltZXJTZWNvbmRzID0gMjtcclxuICAgIHB1YmxpYyB4OiBudW1iZXI7XHJcbiAgICBwdWJsaWMgeTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSByZW1lbWJlcmVkWCA9IDA7XHJcbiAgICBwcml2YXRlIHJlbWVtYmVyZWRZID0gMDtcclxuXHJcbiAgICBwdWJsaWMgY29sb3I6IHN0cmluZztcclxuXHJcbiAgICBwdWJsaWMgZ2V0IGNvbnRyb2xsZXJOYW1lKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udHJvbGxlci5uYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY29udHJvbGxlcjogQ29udHJvbGxlciwgcHJpdmF0ZSBvbkFkZDogKGJsYWRlOiBNZW51QmxhZGUpID0+IHZvaWQsIHByaXZhdGUgb25SZW1vdmU6IChibGFkZTogTWVudUJsYWRlKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9IFwiYmxhY2tcIjtcclxuICAgICAgICB0aGlzLnggPSAwO1xyXG4gICAgICAgIHRoaXMueSA9IDA7XHJcbiAgICAgICAgdGhpcy5hbmdsZSA9IDA7XHJcbiAgICAgICAgdGhpcy5hZGRUaW1lciA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHVwZGF0ZSA9ICh0aW1lRGlmZk1zOiBudW1iZXIpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5pc1Nob3duKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWRkZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYW5nbGUgPSB0aGlzLmFuZ2xlICsgTWF0aC5QSSAvIDk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFuZ2xlID0gdGhpcy5hbmdsZSAlIChNYXRoLlBJICogMik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnggPSB0aGlzLnJlbWVtYmVyZWRYICsgdGhpcy5jb250cm9sbGVyLnhBeGVzICogMjU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnkgPSB0aGlzLnJlbWVtYmVyZWRZICsgdGhpcy5jb250cm9sbGVyLnlBeGVzICogMjU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlci55QXhlcyA+IDAuMykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkVGltZXIgKz0gdGhpcy5jb250cm9sbGVyLnlBeGVzICogdGltZURpZmZNcyAvIDEwMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWRkVGltZXIgPj0gdGhpcy5hZGRUaW1lclNlY29uZHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRUaW1lciA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNTaG93biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQWRkZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblJlbW92ZSh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY29udHJvbGxlci55QXhlcyA8IDAuMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkVGltZXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlci55QXhlcyA8IC0wLjMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFRpbWVyIC09IHRoaXMuY29udHJvbGxlci55QXhlcyAqIHRpbWVEaWZmTXMgLyAxMDAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hZGRUaW1lciA+PSB0aGlzLmFkZFRpbWVyU2Vjb25kcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzQWRkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFRpbWVyID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuY29udHJvbGxlci55QXhlcyA+IC0wLjEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFRpbWVyID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzU2hvd24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uUmVtb3ZlKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlci55QXhlcyA8IC0wLjMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNTaG93biA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFRpbWVyIC09IHRoaXMuY29udHJvbGxlci55QXhlcyAqIHRpbWVEaWZmTXMgLyAxMDAwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkFkZCh0aGlzKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtZW1iZXJlZFggPSB0aGlzLng7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbWVtYmVyZWRZID0gdGhpcy55O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHVibGljIGRyYXcgPSAoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIHdpZHRoPzogbnVtYmVyLCBoZWlnaHQ/OiBudW1iZXIpID0+IHtcclxuICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5jb2xvcjtcclxuICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgIGN0eC50cmFuc2xhdGUodGhpcy54LCB0aGlzLnkpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQWRkZWQpIHtcclxuICAgICAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICAgICAgY3R4LnJvdGF0ZSh0aGlzLmFuZ2xlKTtcclxuICAgICAgICAgICAgY3R4LmZpbGxSZWN0KC0yNSwgLTI1LCA1MCwgNTApO1xyXG4gICAgICAgICAgICBjdHgucmVzdG9yZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNTaG93biAmJiAhdGhpcy5pc0FkZGVkKSB7XHJcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgtMjUsIDM1LCA1MCAvIHRoaXMuYWRkVGltZXJTZWNvbmRzICogdGhpcy5hZGRUaW1lciwgMTApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuaXNTaG93biAmJiB0aGlzLmlzQWRkZWQgJiYgdGhpcy5hZGRUaW1lciA+IDApIHtcclxuICAgICAgICAgICAgY3R4LmZpbGxSZWN0KC0yNSwgMzUsIDUwIC0gNTAgLyB0aGlzLmFkZFRpbWVyU2Vjb25kcyAqIHRoaXMuYWRkVGltZXIsIDEwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBBbmltYXRpb24gfSBmcm9tIFwiLi9hbmltYXRpb25cIjtcclxuaW1wb3J0IHsgQmxhZGUgfSBmcm9tIFwiLi9ibGFkZVwiO1xyXG5pbXBvcnQgeyBLZXlib2FyZENvbnRyb2xzIH0gZnJvbSBcIi4va2V5Ym9hcmRDb250cm9sc1wiO1xyXG5pbXBvcnQgeyBHYW1lcGFkQ29udHJvbHMgfSBmcm9tIFwiLi9nYW1lcGFkQ29udHJvbHNcIjtcclxuaW1wb3J0IHsgTWVudUJsYWRlIH0gZnJvbSBcIi4vbWVudUJsYWRlXCI7XHJcblxyXG52YXIgaGF2ZUV2ZW50cyA9ICdvbmdhbWVwYWRjb25uZWN0ZWQnIGluIHdpbmRvdztcclxuXHJcbmV4cG9ydCBjbGFzcyBBcHAge1xyXG4gICAgcHJpdmF0ZSBpc1BsYXllclNlbGVjdGlvbjogYm9vbGVhbiA9IHRydWU7XHJcbiAgICBwcml2YXRlIGNvbnRyb2xsZXJOYW1lczogc3RyaW5nW10gPSBbXTtcclxuICAgIGFuaW1hdGlvbjogQW5pbWF0aW9uO1xyXG4gICAgY29udHJvbGxlcnM6IGFueSA9IFtdO1xyXG5cclxuICAgIHB1YmxpYyBydW4oKSB7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb24gPSBBbmltYXRpb24uY3JlYXRlSW5Cb2R5KCk7XHJcblxyXG4gICAgICAgIC8vIHZhciBibGFkZTMgPSBuZXcgQmxhZGUobmV3IEdhbWVwYWRDb250cm9scygpLCBcInJlZFwiKTtcclxuICAgICAgICAvLyBpZiAoIW5hdmlnYXRvci5nZXRHYW1lcGFkcygpWzBdKSB7XHJcbiAgICAgICAgLy8gICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiZ2FtZXBhZGNvbm5lY3RlZFwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIC8vICAgICAgICAgYW5pbWF0aW9uLmFkZEFuaW1hdGFibGUoYmxhZGUzKTtcclxuICAgICAgICAvLyAgICAgfSk7XHJcbiAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAvLyAgICAgYW5pbWF0aW9uLmFkZEFuaW1hdGFibGUoYmxhZGUzKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmlzUGxheWVyU2VsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uLmFkZEFuaW1hdGlvbigoY3R4LCB3aWR0aCwgaGVpZ2h0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJibGFja1wiO1xyXG4gICAgICAgICAgICAgICAgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgICAgICAgICBjdHguZm9udCA9IFwiMjJweCBzYW5zLXNlcmlmXCI7XHJcbiAgICAgICAgICAgICAgICBjdHguZmlsbFRleHQoXCJZb3UgY2FuIGNvbnRyb2wgYSBibGFkZSB3aXRoIGEgZ2FtZXBhZCwgdGhlIGFycm93IGtleXMgb3IgV0FTRC5cIiwgd2lkdGggLyAyLCA1MCk7XHJcbiAgICAgICAgICAgICAgICBjdHguZmlsbFRleHQoXCJQcmVzcyB1cCB0byBqb2luIGFuZCBkb3duIHRvIGxlYXZlLlwiLCB3aWR0aCAvIDIsIDgwKTtcclxuICAgICAgICAgICAgICAgIGN0eC5maWxsVGV4dChcIlByZXNzIGVudGVyIG9uIGtleWJvYXJkIG9yIHN0YXJ0IG9uIGEgY29udHJvbGxlciB0byBzdGFydC5cIiwgd2lkdGggLyAyLCAxMTApO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBibGFkZTEgPSBuZXcgTWVudUJsYWRlKG5ldyBLZXlib2FyZENvbnRyb2xzKFwiYXJyb3dzXCIsIDM3LCAzOCwgMzksIDQwKSwgdGhpcy5hZGRDb250cm9sbGVyLCB0aGlzLnJlbW92ZUNvbnRyb2xsZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbi5hZGRBbmltYXRhYmxlKGJsYWRlMSk7XHJcbiAgICAgICAgICAgIHZhciBibGFkZTIgPSBuZXcgTWVudUJsYWRlKG5ldyBLZXlib2FyZENvbnRyb2xzKFwid2FzZFwiLCA2NSwgODcsIDY4LCA4MyksIHRoaXMuYWRkQ29udHJvbGxlciwgdGhpcy5yZW1vdmVDb250cm9sbGVyKTtcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRpb24uYWRkQW5pbWF0YWJsZShibGFkZTIpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJnYW1lcGFkY29ubmVjdGVkXCIsIHRoaXMuY29ubmVjdGhhbmRsZXIpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiZ2FtZXBhZGRpc2Nvbm5lY3RlZFwiLCB0aGlzLmRpc2Nvbm5lY3RoYW5kbGVyKTtcclxuXHJcbiAgICAgICAgaWYgKCFoYXZlRXZlbnRzKSB7XHJcbiAgICAgICAgICAgIHNldEludGVydmFsKHRoaXMuc2NhbmdhbWVwYWRzLCA1MDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhZGRDb250cm9sbGVyID0gKG1lbnVCbGFkZTogTWVudUJsYWRlKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJhZGRlZCBjb250cm9sbGVyIFwiICsgbWVudUJsYWRlLmNvbnRyb2xsZXJOYW1lKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlck5hbWVzLmxlbmd0aCA8PSA0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbGxlck5hbWVzLnB1c2gobWVudUJsYWRlLmNvbnRyb2xsZXJOYW1lKTtcclxuICAgICAgICAgICAgbGV0IGNvbG9yID0gXCJibGFja1wiO1xyXG4gICAgICAgICAgICBsZXQgc3RhcnRYID0gMDtcclxuICAgICAgICAgICAgbGV0IHN0YXJ0WSA9IDA7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5jb250cm9sbGVyTmFtZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBcInJlZFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0WCA9IHRoaXMuYW5pbWF0aW9uLndpZHRoIC8gMztcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFkgPSAodGhpcy5hbmltYXRpb24uaGVpZ2h0IC0gMTAwKSAvIDMgKyAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBcImdyZWVuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRYID0gdGhpcy5hbmltYXRpb24ud2lkdGggLyAzICogMjtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFkgPSAodGhpcy5hbmltYXRpb24uaGVpZ2h0IC0gMTAwKSAvIDMgKyAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBcImJsdWVcIjtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFggPSB0aGlzLmFuaW1hdGlvbi53aWR0aCAvIDM7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRZID0gKHRoaXMuYW5pbWF0aW9uLmhlaWdodCAtIDEwMCkgLyAzICogMiArIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDpcclxuICAgICAgICAgICAgICAgICAgICBjb2xvciA9IFwib3JhbmdlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRYID0gdGhpcy5hbmltYXRpb24ud2lkdGggLyAzICogMjtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFkgPSAodGhpcy5hbmltYXRpb24uaGVpZ2h0IC0gMTAwKSAvIDMgKiAyICsgMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1lbnVCbGFkZS5jb2xvciA9IGNvbG9yO1xyXG4gICAgICAgICAgICBtZW51QmxhZGUueCA9IHN0YXJ0WDtcclxuICAgICAgICAgICAgbWVudUJsYWRlLnkgPSBzdGFydFk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTb3JyeSwgb25seSA0IGNvbnRyb2xsZXJzIHN1cHBvcnRlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW1vdmVDb250cm9sbGVyID0gKG1lbnVCbGFkZTogTWVudUJsYWRlKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJyZW1vdmVkIGNvbnRyb2xsZXIgXCIgKyBtZW51QmxhZGUuY29udHJvbGxlck5hbWUpO1xyXG5cclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXJOYW1lcy5zcGxpY2UodGhpcy5jb250cm9sbGVyTmFtZXMuaW5kZXhPZihtZW51QmxhZGUuY29udHJvbGxlck5hbWUpLCAxKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25uZWN0aGFuZGxlciA9IChlOiBHYW1lcGFkRXZlbnQpID0+IHtcclxuICAgICAgICB0aGlzLmFkZGdhbWVwYWQoZS5nYW1lcGFkKTtcclxuICAgIH1cclxuXHJcbiAgICBzY2FuZ2FtZXBhZHMgPSAoKSA9PiB7XHJcbiAgICAgICAgdmFyIGdhbWVwYWRzID0gbmF2aWdhdG9yLmdldEdhbWVwYWRzID8gbmF2aWdhdG9yLmdldEdhbWVwYWRzKCkgOiBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdhbWVwYWRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChnYW1lcGFkc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGdhbWVwYWRzW2ldLmluZGV4IGluIHRoaXMuY29udHJvbGxlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXJzW2dhbWVwYWRzW2ldLmluZGV4XSA9IGdhbWVwYWRzW2ldO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZGdhbWVwYWQoZ2FtZXBhZHNbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRpc2Nvbm5lY3RoYW5kbGVyID0gKGU6IEdhbWVwYWRFdmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlZ2FtZXBhZChlLmdhbWVwYWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZWdhbWVwYWQgPSAoZ2FtZXBhZDogR2FtZXBhZCkgPT4ge1xyXG4gICAgICAgIGRlbGV0ZSB0aGlzLmNvbnRyb2xsZXJzW2dhbWVwYWQuaW5kZXhdO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZGdhbWVwYWQgPSAoZ2FtZXBhZDogR2FtZXBhZCkgPT4ge1xyXG4gICAgICAgIHZhciBibGFkZSA9IG5ldyBNZW51QmxhZGUobmV3IEdhbWVwYWRDb250cm9scyhnYW1lcGFkLmluZGV4LnRvU3RyaW5nKCksIGdhbWVwYWQuaW5kZXgpLCB0aGlzLmFkZENvbnRyb2xsZXIsIHRoaXMucmVtb3ZlQ29udHJvbGxlcik7XHJcbiAgICAgICAgdGhpcy5hbmltYXRpb24uYWRkQW5pbWF0YWJsZShibGFkZSk7XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyc1tnYW1lcGFkLmluZGV4XSA9IGdhbWVwYWQ7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBBcHAgfSBmcm9tIFwiLi9hcHBcIjtcclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBtYWluLCBmYWxzZSk7XHJcblxyXG5mdW5jdGlvbiBtYWluKCkge1xyXG4gIGNvbnN0IGFwcCA9IG5ldyBBcHAoKTtcclxuICBhcHAucnVuKCk7XHJcbn0iXSwic291cmNlUm9vdCI6IiJ9